name: Manually triggered workflow
on:
  push:
    branches: [main]

jobs:
  prod-check:
    if: ${{ github.ref == 'refs/heads/main' }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "Deploying to production server on branch $GITHUB_REF"
      - run: echo ${{ github.ref }}
      - run: echo ${{ github.action }}
      - run: echo ${{ github.action_path }}
      - run: echo ${{ github.actor }}
      - run: echo ${{ github.base_ref }}
      - run: echo ${{ github.event }}
      - run: echo ${{ github.event_name }}
      - run: echo ${{ github.event_path }}
      - run: echo ${{ github.head_ref }}
      - run: echo ${{ github.job }}
      - run: ehco ${{ github.repository }}
      - run: ehco ${{ github.repository_owner }}
      - run: ehco ${{ github.sha }}
      - run: ehco ${{ github.token }}
      - run: ehco ${{ github.workflow }}
      - run: ehco ${{ github.workspace }}



#name: Django CI
#
#on:
#  push:
#    branches: [ main ]
#  pull_request:
#    branches: [ main ]
#
#jobs:
#  build:
#
#    runs-on: ubuntu-latest
#    strategy:
#      max-parallel: 4
#      matrix:
#        python-version: [3.9]
#
#    steps:
#      - uses: actions/checkout@v2
#      - name: Set up Python ${{ matrix.python-version }}
#        uses: actions/setup-python@v2
#        with:
#          python-version: ${{ matrix.python-version }}
#      - name: Install Dependencies
#        run: |
#          python -m pip install --upgrade pip
#          pip install -r requirements.txt
#      - name: Run Tests
#        run: |
#          python manage.py test
#
#  deploy:
#    needs: [build]
#    runs-on: ubuntu-latest
#    environment: prod
#    strategy:
#      max-parallel: 4
#      matrix:
#        python-version: [3.9]
#    steps:
#      - uses: actions/checkout@v2
#      - name: Set up Python ${{ matrix.python-version }}
#        uses: actions/setup-python@v2
#        with:
#          python-version: ${{ matrix.python-version }}
#      - name: Create SSH config
#        run: |
#          mkdir ~/.ssh
#          echo $SSH_CONFIG >> ~/.ssh/config
#        env:
#          SSH_CONFIG: ${{ secrets.SSH_CONFIG }}
#      - name: Install SSH Key
#        uses: shimataro/ssh-key-action@v2
#        with:
#          key: ${{ secrets.SSH_PRIVATE_KEY }}
#          known_hosts: 'just-a-placeholder-so-we-dont-get-errors'
#      - name: Adding Known Hosts
#        run: ssh-keyscan -p 2222 -t rsa -H ${{ secrets.SSH_HOST }} >> ~/.ssh/known_hosts
#      - name: Prepare before deploy
#        run: |
#          sudo apt-get install -yqq git gcc g++ binutils musl-dev libffi-dev libssl-dev make openssh-client
#          python -m pip install --upgrade pip
#          pip install -r requirements.txt
#          mkdir -p ~/.ssh
#      - name: Deploy staging
##        env:
##          DEPLOY_HOST: ${{ secrets.DEPLOY_HOST }}
##          DEPLOY_HOSTS: ${{ secrets.DEPLOY_HOSTS }}
##          DEPLOY_HOST_NAMES: ${{ secrets.DEPLOY_HOST_NAMES }}
##          DEPLOY_KNOWN_HOST: ${{ secrets.DEPLOY_KNOWN_HOST }}
##          DEPLOY_USE_CHRONY: "true"
##          DEPLOY_STAGING_SYSTEM_PRIVATE_KEY: ${{ secrets.DEPLOY_STAGING_PRIVATE_KEY }}
##          DEPLOY_SYSTEM_PRIVATE_KEY: ${{ secrets.DEPLOY_SYSTEM_PRIVATE_KEY }}
##          DEPLOY_STAGING_PRIVATE_KEY: ${{ secrets.DEPLOY_STAGING_PRIVATE_KEY }}
#        run: |
#          pwd
#          fab stage deploy:branch=main